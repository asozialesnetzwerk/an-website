{
  "version": 3,
  "sources": ["../../../quotes/quotes.ts"],
  "sourcesContent": ["// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later\nfunction startQuotes() {\n    const nextButton = elById(\"next\") as HTMLAnchorElement;\n    const upvoteButton = elById(\"upvote\") as HTMLButtonElement;\n    const downvoteButton = elById(\"downvote\") as HTMLButtonElement;\n    const reportButton = elById(\"report\") as HTMLAnchorElement | null;\n\n    const thisQuoteId = [\n        (elById(\"top\")!).getAttribute(\"quote-id\")!,\n    ];\n    const nextQuoteId = [nextButton.getAttribute(\"quote-id\")!];\n    const params = window.location.search;\n\n    const keys = (() => {\n        const k = new URLSearchParams(params).get(\"keys\");\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        if (!(k?.k.length)) {\n            return \"WASD\";\n        }\n        // for vim-like set keys to khjl\n        if (k.length === 4) {\n            return k.toUpperCase();\n        } else {\n            alert(\"Invalid keys given, using default.\");\n            return \"WASD\";\n        }\n    })(); // currently only letter keys are supported\n\n    (elById(\"wasd\")!).innerText =\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        `${keys[0]} (Witzig), ${keys[2]} (Nicht Witzig), ` +\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        `${keys[1]} (Vorheriges) und ${keys[3]} (Nächstes)`;\n\n    document.onkeydown = (event) => {\n        switch (event.code) {\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            case `Key${keys[0]}`:\n                upvoteButton.click();\n                break;\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            case `Key${keys[1]}`:\n                window.history.back();\n                break;\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            case `Key${keys[2]}`:\n                downvoteButton.click();\n                break;\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            case `Key${keys[3]}`:\n                nextButton.click();\n        }\n    };\n\n    const shareButton = elById(\"share\") as HTMLAnchorElement;\n    const downloadButton = elById(\"download\") as HTMLAnchorElement;\n\n    const author = elById(\"author\") as HTMLAnchorElement;\n    const quote = elById(\"quote\") as HTMLAnchorElement;\n    const realAuthor = elById(\"real-author-name\") as HTMLAnchorElement;\n\n    const ratingText = elById(\"rating-text\") as HTMLDivElement;\n    const ratingImageContainer = elById(\n        \"rating-img-container\",\n    ) as HTMLDivElement;\n\n    nextButton.removeAttribute(\"href\");\n\n    function updateQuoteId(quoteId: string): void {\n        shareButton.href = `/zitate/share/${quoteId}${params}`;\n        downloadButton.href = `/zitate/${quoteId}.gif${params}`;\n        const [q_id, a_id] = quoteId.split(\"-\", 2);\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        quote.href = `/zitate/info/z/${q_id}${params}`;\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        author.href = `/zitate/info/a/${a_id}${params}`;\n        thisQuoteId[0] = quoteId;\n    }\n\n    function updateRating(rating: number | string) {\n        rating = rating.toString();\n        ratingText.innerText = rating;\n        if ([\"---\", \"???\", \"0\"].includes(rating)) {\n            ratingImageContainer.innerHTML = \"\";\n            return;\n        }\n        const ratingNum = Number.parseInt(rating);\n        const ratingImg = document.createElement(\"div\");\n        ratingImg.className = \"rating-img\" + (\n            ratingNum > 0 ? \" witzig\" : \" nicht-witzig\"\n        );\n        ratingImageContainer.innerHTML = (ratingImg.outerHTML + \" \")\n            .repeat(\n                Math.min(4, Math.abs(ratingNum)),\n            )\n            .trim();\n    }\n\n    function updateVote(vote: number | string): void {\n        function update(\n            btn: HTMLButtonElement,\n            btn_vote: number,\n            btn_vote_str: string,\n        ) {\n            btn.disabled = false;\n            if (vote === btn_vote || vote === btn_vote_str) {\n                // the vote of the button is active\n                btn.setAttribute(\"voted\", btn_vote_str);\n                btn.value = \"0\"; // if pressed again reset the vote\n            } else {\n                // the vote of the button isn't active\n                btn.removeAttribute(\"voted\");\n                btn.value = btn_vote_str; // if pressed, vote with the button\n            }\n        }\n        // update the upvote button\n        update(upvoteButton, 1, \"1\");\n        // update the downvote button\n        update(downvoteButton, -1, \"-1\");\n    }\n\n    interface API_DATA {\n        // either this\n        status: number | undefined;\n        reason: string;\n        // or the following\n        id: string;\n        rating: string;\n        vote: number;\n        quote: string;\n        author: string;\n        real_author: string;\n        real_author_id: number;\n        next: string;\n    }\n    function handleData(\n        data: API_DATA,\n    ): boolean {\n        if (data.status) {\n            console.error(data);\n            if (data.status in [429, 420]) {\n                // ratelimited\n                alert(data.reason);\n            }\n            return false;\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        } else if (data?.data.id) {\n            updateQuoteId(data.id);\n            nextQuoteId[0] = data.next;\n            quote.innerText = `»${data.quote}«`;\n            author.innerText = `- ${data.author}`;\n            realAuthor.innerText = data.real_author;\n            realAuthor.href = `/zitate/info/a/${data.real_author_id}${params}`;\n            if (reportButton) {\n                const reportHrefParams = new URLSearchParams(params);\n                reportHrefParams.set(\n                    \"subject\",\n                    `Das falsche Zitat ${data.id} hat ein Problem`,\n                );\n                reportHrefParams.set(\n                    \"message\",\n                    `${quote.innerText} ${realAuthor.innerText}`,\n                );\n                reportButton.href = `/kontakt?${reportHrefParams.toString()}`;\n            }\n            updateRating(data.rating);\n            updateVote(data.vote);\n            return true;\n        }\n        return false;\n    }\n\n    PopStateHandlers.quotes = (event: PopStateEvent) => {\n        event.state && handleData(event.state as API_DATA);\n    };\n\n    interface POP_STATE_API_DATA extends API_DATA {\n        stateType: string;\n        url: string;\n    }\n\n    nextButton.onclick = () =>\n        get(\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            `/api/zitate/${nextQuoteId[0]}`,\n            params,\n            (data: POP_STATE_API_DATA) => {\n                if (!handleData(data)) {\n                    return;\n                }\n\n                data.stateType = \"quotes\";\n                data.url = `/zitate/${data.id}${params}`;\n                window.history.pushState(data, \"Falsche Zitate\", data.url);\n                setLastLocation(data.url);\n            },\n        );\n\n    const vote = (vote: string): Promise<void> =>\n        post(\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            `/api/zitate/${thisQuoteId[0]}`,\n            { vote: vote },\n            (data: API_DATA) => void handleData(data),\n        );\n\n    for (const voteButton of [upvoteButton, downvoteButton]) {\n        voteButton.type = \"button\";\n        voteButton.onclick = () => {\n            upvoteButton.disabled = true;\n            downvoteButton.disabled = true;\n            vote(voteButton.value)\n                .then(() => {\n                    upvoteButton.disabled = false;\n                    downvoteButton.disabled = false;\n                })\n                .catch(() => {\n                    upvoteButton.disabled = false;\n                    downvoteButton.disabled = false;\n                });\n        };\n    }\n}\n\nfor (\n    const autoSubmitEl of (document.getElementsByClassName(\n        \"auto-submit-element\",\n    ) as HTMLCollectionOf<HTMLInputElement>)\n) {\n    autoSubmitEl.onchange = () => (autoSubmitEl.form!).submit();\n}\n\nstartQuotes();\n// @license-end\n"],
  "mappings": "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",
  "names": ["nextButton", "upvoteButton", "downvoteButton", "reportButton", "thisQuoteId", "nextQuoteId", "params", "keys", "k", "event", "shareButton", "downloadButton", "author", "quote", "realAuthor", "ratingText", "ratingImageContainer", "updateQuoteId", "quoteId", "q_id", "a_id", "updateRating", "rating", "ratingNum", "ratingImg", "updateVote", "vote", "update", "btn", "btn_vote", "btn_vote_str", "handleData", "data", "reportHrefParams", "voteButton", "autoSubmitEl"]
}
