// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later
import{get as h,PopStateHandlers as p,setLastLocation as m}from"./utils.js";import{hideSitePane as c}from"./better_ui.js";const s=document.getElementById("main");let d={};const l=[];function a(t,e){if(!t){console.error("No data received");return}if(t.redirect){window.location.href=t.redirect;return}const o=t.url;if(!o){console.error("No URL in data ",t);return}if(console.log("Handling data",t),!e){if(l.length===1&&l[0]===o){console.log("URL is the same as last loaded, ignoring");return}history.pushState({data:t,url:o,stateType:"dynLoad"},t.title,o),m(o)}if(!t.body){window.location.reload();return}if(document.onkeydown=()=>{},s.innerHTML=t.body,t.css){const n=document.createElement("style");n.innerHTML=t.css,s.appendChild(n)}if(t.stylesheets)for(const n of t.stylesheets){const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=n,s.appendChild(i)}if(t.scripts)for(const n of t.scripts)if(n.src){const i=document.createElement("script");i.type=n.type,i.src=n.src,s.appendChild(i)}else console.error("Script without src",n);window.hideSitePane&&c(),document.title=t.title;const r=document.getElementById("title");return r&&(r.setAttribute("short_title",t.short_title||t.title),r.innerText=t.title),f(),d=t,!0}function f(){for(const t of document.getElementsByTagName("A"))w(t)}function w(t){t.hasAttribute("no-dynload")||y(t)}function y(t){var r;if(t.target==="_blank")return;const e=(t.href.startsWith("/")?window.location.origin+t.href:t.href).trim(),o=e.split("?")[0];!e.startsWith(window.location.origin)||((r=o.split("/").pop())!=null?r:"").includes(".")&&o!==window.location.origin+"/redirect"||o===window.location.origin+"/chat"||e.startsWith("#")||e.startsWith(window.location.href.split("#")[0]+"#")||(t.onclick=n=>{g(e),n.preventDefault()})}function g(t){console.log("Loading URL",t),history.replaceState({data:d,url:window.location.href,scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],stateType:"dynLoad"},document.title,window.location.href),u(t)}function u(t,e=!1){if(!e&&t===window.location.href){console.log("URL is the same as current, just hide site pane"),window.hideSitePane&&c();return}s.prepend("Laden... Wenn dies zu lange (Ã¼ber ein paar Sekunden) dauert, lade bitte die Seite neu."),h(t,"",o=>a(o,!1),o=>{console.log(o),t===window.location.href?window.location.reload():window.location.href=t},"application/vnd.asozial.dynload+json")}function L(t){if(t.state){const e=t.state;if(console.log("Popstate",e),t.state.data&&a(e,!0)||u(e.url||window.location.href,!0),e.scrollPos){window.scrollTo(e.scrollPos[0],e.scrollPos[1]);return}}console.error("Couldn't handle state.",t.state),window.location.reload()}p.dynLoad=L;f();// @license-end
//# sourceMappingURL=dynload.js.map
