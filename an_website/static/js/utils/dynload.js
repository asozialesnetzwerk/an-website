// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later
import{get as h,hideSitePane as a,PopStateHandlers as p,setLastLocation as m}from"./utils.ts";const l=document.getElementById("main");let d={};const c=[];function u(t,e){var i;if(!t){console.error("No data received");return}if(t.redirect){location.href=t.redirect;return}const n=t.url;if(!n){console.error("No URL in data ",t);return}if(!e){if(c.length===1&&c[0]===n)return;history.pushState({data:t,url:n,stateType:"dynLoad"},t.title,n),m(n)}if(!t.body){location.reload();return}if(document.onkeydown=()=>{},l.innerHTML=t.body,t.css){const r=document.createElement("style");r.innerHTML=t.css,l.appendChild(r)}for(const r of t.stylesheets){const s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=r,l.appendChild(s)}for(const r of t.scripts)if(r.src){const s=document.createElement("script");s.type=r.type,s.src=r.src,l.appendChild(s)}else console.error("Script without src",r);(i=a)==null||i(),document.title=t.title;const o=document.getElementById("title");return o&&(o.setAttribute("short_title",t.short_title||t.title),o.innerText=t.title),d=t,!0}function y(t){return history.replaceState({data:d,url:location.href,scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],stateType:"dynLoad"},document.title,location.href),f(t)}async function f(t,e=!1){var n;if(!e&&t===location.href){(n=a)==null||n();return}l.prepend("Laden... Wenn dies zu lange (Ã¼ber ein paar Sekunden) dauert, lade bitte die Seite neu."),await h(t,"",o=>u(o,!1),o=>{t===location.href?location.reload():location.href=t},"application/vnd.asozial.dynload+json")}async function g(t){if(t.state){const e=t.state;if(t.state.data&&u(e,!0)||await f(e.url||location.href,!0),e.scrollPos){scrollTo(e.scrollPos[0],e.scrollPos[1]);return}}console.error("Couldn't handle state.",t.state),location.reload()}const L=()=>{p.dynLoad=g,document.addEventListener("click",t=>{var r,s;if(((r=t.target)==null?void 0:r.tagName)!=="A")return;const e=t.target;if(e.target==="_blank")return;const n=location.origin,o=(e.href.startsWith("/")?n+e.href:e.href).trim(),i=o.split("?")[0];if(!(!o.startsWith(n)||((s=i.split("/").pop())!=null?s:"").includes(".")&&i!==n+"/redirect"||i===n+"/chat")&&!(o.startsWith("#")||o.startsWith(location.href.split("#")[0]+"#")))return t.preventDefault(),y(o)})};L();// @license-end
//# sourceMappingURL=dynload.js.map
