// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later
import{get as f,PopStateHandlers as h,setLastLocation as p}from"./utils.js";import{hideSitePane as c}from"./better_ui.js";const s=document.getElementById("main");let a={};const l=[];function d(t,e){if(!t){console.error("No data received");return}if(t.redirect){window.location.href=t.redirect;return}const n=t.url;if(!n){console.error("No URL in data ",t);return}if(console.log("Handling data",t),!e){if(l.length===1&&l[0]===n){console.log("URL is the same as last loaded, ignoring");return}history.pushState({data:t,url:n,stateType:"dynLoad"},t.title,n),p(n)}if(!t.body){window.location.reload();return}if(document.onkeydown=()=>{},s.innerHTML=t.body,t.css){const o=document.createElement("style");o.innerHTML=t.css,s.appendChild(o)}for(const o of t.stylesheets){const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=o,s.appendChild(i)}for(const o of t.scripts)if(o.src){const i=document.createElement("script");i.type=o.type,i.src=o.src,s.appendChild(i)}else console.error("Script without src",o);window.hideSitePane&&c(),document.title=t.title;const r=document.getElementById("title");return r&&(r.setAttribute("short_title",t.short_title||t.title),r.innerText=t.title),a=t,!0}function w(t){return console.log("Loading URL",t),history.replaceState({data:a,url:window.location.href,scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],stateType:"dynLoad"},document.title,window.location.href),u(t)}async function u(t,e=!1){if(!e&&t===window.location.href){console.log("URL is the same as current, just hide site pane"),window.hideSitePane&&c();return}s.prepend("Laden... Wenn dies zu lange (Ã¼ber ein paar Sekunden) dauert, lade bitte die Seite neu."),await f(t,"",n=>d(n,!1),n=>{console.log(n),t===window.location.href?window.location.reload():window.location.href=t},"application/vnd.asozial.dynload+json")}async function m(t){if(t.state){const e=t.state;if(console.log("Popstate",e),t.state.data&&d(e,!0)||await u(e.url||window.location.href,!0),e.scrollPos){window.scrollTo(e.scrollPos[0],e.scrollPos[1]);return}}console.error("Couldn't handle state.",t.state),window.location.reload()}h.dynLoad=m;document.addEventListener("click",t=>{var o,i;if(((o=t.target)==null?void 0:o.tagName)!=="A")return;const e=t.target;if(e.target==="_blank")return;const n=(e.href.startsWith("/")?window.location.origin+e.href:e.href).trim(),r=n.split("?")[0];if(!(!n.startsWith(window.location.origin)||((i=r.split("/").pop())!=null?i:"").includes(".")&&r!==window.location.origin+"/redirect"||r===window.location.origin+"/chat")&&!(n.startsWith("#")||n.startsWith(window.location.href.split("#")[0]+"#")))return t.preventDefault(),w(n)});// @license-end
//# sourceMappingURL=dynload.js.map
