// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later
var r=window.document;let p=String(location);export function setLastLocation(e){p=e}export function post(e,o={},a=console.log,s=console.error,n="application/json"){return fetch(e,{method:"POST",body:JSON.stringify(o),headers:{Accept:n,"Content-Type":"application/json"}}).then(i=>i.json()).catch(s).then(a).catch(s)}export function get(e,o={},a=console.log,s=console.error,n="application/json"){const i=new URLSearchParams(o).toString();return fetch(i?"".concat(e,"?").concat(i):e,{method:"GET",headers:{Accept:n}}).then(f=>f.json()).catch(s).then(a).catch(s)}export const PopStateHandlers={URLParamChange:()=>{location.reload()}};export function setURLParam(e,o,a,s="URLParamChange",n=!0){return setMultipleURLParams([[e,o]],a,s,n)}export function setMultipleURLParams(e,o,a="URLParamChange",s=!0){const n=new URLSearchParams(location.search);for(const[f,t]of e)n.set(f,t);const i="".concat(location.origin).concat(location.pathname,"?").concat(n.toString());return o.stateType=a,s&&i!==location.href?history.pushState(o,i,i):history.replaceState(o,i,i),p=location.href,i}function g(){if(location.hash==="")return;const e=r.getElementById("header");if(!e)return;const o=r.querySelector(location.hash);o&&scrollBy(0,o.getBoundingClientRect().top-Math.floor(parseFloat(getComputedStyle(e).height)))}setTimeout(g,4);window.onhashchange=g;window.onpopstate=e=>{if(p.split("#")[0]===location.href.split("#")[0]){p=location.href,g();return}if(e.state){const o=e.state,a=PopStateHandlers[o.stateType];if(a){e.preventDefault(),a(e),p=location.href,g();return}else console.error("Couldn't find state handler for state",o)}console.error("Couldn't handle state. ",e.state),p=location.href,location.reload()};export function showSitePane(){var e;(e=r.getElementById("site-pane"))==null||e.setAttribute("open","")}export function hideSitePane(){var e;(e=r.getElementById("site-pane"))==null||e.removeAttribute("open")}(()=>{const e=r.getElementById("open-pane"),o=r.getElementById("site-pane");if(!e||!o)throw Error("open-pane or site-pane not found");const a=n=>n===e||n===o||o.contains(n);e.onmouseover=showSitePane,o.onmouseleave=hideSitePane,r.onfocus=n=>{a(n.target)?showSitePane():hideSitePane()},e.onclick=showSitePane,r.onclick=n=>{a(n.target)||hideSitePane()};const s={x:null,y:null};r.ontouchstart=n=>{s.x=n.touches[0].clientX,s.y=n.touches[0].clientY},r.ontouchmove=n=>{if(s.x===null||s.y===null)return;const i=s.x-n.touches[0].clientX,f=s.y-n.touches[0].clientY;if(i===0&&f===0)return;s.x=null,s.y=null;const t=Math.max(12,.01*screen.width,f*1.5);Math.abs(i)>=t&&(i>0?showSitePane():hideSitePane())}})();export const enableDynload=()=>{const e=r.getElementById("main");let o={};const a=[];function s(t,l){if(!t){console.error("No data received");return}if(t.redirect){location.href=t.redirect;return}const c=t.url;if(!c){console.error("No URL in data ",t);return}if(!l){if(a.length===1&&a[0]===c)return;history.pushState({data:t,url:c,stateType:"dynLoad"},t.title,c),setLastLocation(c)}if(!t.body){location.reload();return}if(r.onkeydown=()=>{},e.innerHTML=t.body,t.css){const u=r.createElement("style");u.innerHTML=t.css,e.appendChild(u)}for(const u of t.stylesheets){const d=r.createElement("link");d.rel="stylesheet",d.type="text/css",d.href=u,e.appendChild(d)}for(const u of t.scripts)if(u.src){const d=r.createElement("script");d.type=u.type,d.src=u.src,e.appendChild(d)}else console.error("Script without src",u);hideSitePane==null||hideSitePane(),r.title=t.title;const h=r.getElementById("title");return h&&(h.setAttribute("short_title",t.short_title||t.title),h.innerText=t.title),o=t,!0}function n(t){return history.replaceState({data:o,url:location.href,scrollPos:[r.documentElement.scrollLeft||r.body.scrollLeft,r.documentElement.scrollTop||r.body.scrollTop],stateType:"dynLoad"},r.title,location.href),i(t)}async function i(t,l=!1){if(!l&&t===location.href){hideSitePane==null||hideSitePane();return}e.prepend("Laden... Wenn dies zu lange (Ã¼ber ein paar Sekunden) dauert, lade bitte die Seite neu."),await get(t,"",c=>s(c,!1),c=>{t===location.href?location.reload():location.href=t},"application/vnd.asozial.dynload+json")}async function f(t){if(t.state){const l=t.state;if(t.state.data&&s(l,!0)||await i(l.url||location.href,!0),l.scrollPos){scrollTo(l.scrollPos[0],l.scrollPos[1]);return}}console.error("Couldn't handle state.",t.state),location.reload()}PopStateHandlers.dynLoad=f,r.addEventListener("click",t=>{var d,y;if(((d=t.target)==null?void 0:d.tagName)!=="A")return;const l=t.target;if(l.target==="_blank")return;const c=location.origin,h=(l.href.startsWith("/")?c+l.href:l.href).trim(),u=h.split("?")[0];if(!(!h.startsWith(c)||((y=u.split("/").pop())!=null?y:"").includes(".")&&u!==c+"/redirect"||u===c+"/chat")&&!(h.startsWith("#")||h.startsWith(location.href.split("#")[0]+"#")))return t.preventDefault(),n(h)})};// @license-end
//# sourceMappingURL=utils.js.map
