// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0-or-later
import{PopStateHandlers as h,setMultipleURLParams as S}from"../utils/utils.js";const E="_",d=/_+/g,v=/[#?]/g,_=/\s+/g,x=/(.)(?=.*\1)/g;function y(){return document.getElementById("hangman-solver-form")}const l=e=>e.value.toLowerCase();function m(){return{input:[document.querySelector("input[name='input']"),e=>l(e).replace(v,E)],invalid:[document.querySelector("input[name='invalid']"),l],max_words:[document.querySelector("input[name='max_words']"),e=>Number.parseInt(e.value,10)],crossword_mode:[document.querySelector("input[name='crossword_mode']"),e=>e.checked],lang:[document.querySelector("select[name='lang']"),l]}}function b(){const e=m();return{input:e.input[1](e.input[0]),invalid:e.invalid[1](e.invalid[0]),max_words:e.max_words[1](e.max_words[0]),crossword_mode:e.crossword_mode[1](e.crossword_mode[0]),lang:e.lang[1](e.lang[0])}}function M(){return{letterOutput:document.getElementById("letter-frequency-information"),wordOutput:document.getElementById("matching-words")}}function T(e){return((e.crossword_mode?"":e.input.replace(d,""))+e.invalid).toLowerCase().replace(_,"").replace(x,"")}function C(e){const t="[^"+T(e)+"]",r=e.input.replace(d,n=>t+(n.length>1?"{"+n.length+"}":""));return new RegExp("^"+r+"$","u")}async function H(e){const t=[...e.input].length;try{return await _loadWords(e.lang,t)}catch(r){return console.error("error loading words",r),[]}}const p=new Map;export async function _loadWords(e,t){let r=p.get(e);if(r){const o=r.get(t);if(o)return o}else r=new Map,p.set(e,r);const n=await fetch("/hangman-loeser/worte/".concat(e.toLowerCase(),"/").concat(t,".txt"),{method:"GET",headers:{Accept:"text/plain"}});n.status!==200&&n.status!==404&&console.error("error loading words",n);const s=n.ok?(await n.text()).split("\n"):[];return r.set(t,s),s}function g(e,t,r,n){var o,a,i;if(n){for(const u of r)e.set(u,((o=e.get(u))!=null?o:0)-1);for(const u of t)e.set(u,((a=e.get(u))!=null?a:0)+1);return}const s=[...r];for(const u of t)s.includes(u)||(e.set(u,((i=e.get(u))!=null?i:0)+1),s.push(u))}async function L(e){const t=await H(e),r=e.invalid,n=e.input.replace(d,""),s=r.length===0&&n.length===0;if(n.length===e.input.length){const o=n.toLowerCase();return I(t,o)?[[o],new Map]:[[],new Map]}else if(s){const o=new Map;return t.forEach(a=>{g(o,a,"",e.crossword_mode)}),[t,o]}else{const o=new Map,a=C(e);return[t.filter(i=>a.test(i)?(g(o,i,n,e.crossword_mode),!0):!1),o]}}async function f(e){console.debug("state changed",e);const[t,r]=await L(e),n=M();if(t.length>0){n.wordOutput.innerHTML="".concat(Math.min(e.max_words,t.length),"/").concat(t.length," passenden Wörter:");const s=document.createElement("ul");for(const a of t.slice(0,e.max_words)){const i=document.createElement("li");i.innerText=a,s.appendChild(i)}n.wordOutput.appendChild(s);const o=[...r.entries()].filter(([a,i])=>i>0);o.sort((a,i)=>i[1]-a[1]),n.letterOutput.innerText="Mögliche Buchstaben: "+o.map(a=>a.join(": ")).join(", ")}else n.letterOutput.innerText="Nichts gefunden.",n.wordOutput.innerText=""}function I(e,t){let r=0,n=e.length-1;for(;r<=n;){const s=Math.floor((r+n)/2);if(e[s]===t)return!0;e[s]<t?r=s+1:n=s-1}return!1}const w="HangmanSolverState";function c(e=void 0){const t=b();return S(Object.entries(t).map(([r,n])=>[r,n.toString()]),t,w),e==null||e.preventDefault(),f(t)}function O(e){const t=m();t.input[0].value=e.input,t.crossword_mode[0].checked=e.crossword_mode,t.invalid[0].value=e.invalid,t.max_words[0].value=e.max_words.toString(),t.lang[0].value=e.lang}function R(e){const t=e.state;return O(t),e.preventDefault(),f(t)}function j(){h[w]=R,y().addEventListener("submit",c);const e=m();e.lang[0].addEventListener("change",c),e.crossword_mode[0].addEventListener("change",c)}j();// @license-end
//# sourceMappingURL=hangman_solver.js.map
